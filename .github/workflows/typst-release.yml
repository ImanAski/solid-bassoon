name: Generate Typst PDF and Upload to Release

# Trigger this workflow when a new release is published
on:
  release:
    types: [published]

jobs:
  build-and-upload:
    runs-on: ubuntu-latest
    # Set permissions for the GITHUB_TOKEN to allow uploading to the release
    permissions:
      contents: write

    steps:
      # Step 1: Check out the repository content
      - name: Checkout repository
        uses: actions/checkout@v4

      # Step 2: Install Vazirmatn font using the dedicated Fontist action
      - name: Install Vazirmatn Font via Fontist
        uses: fontist/setup-fontist@v2
        with:
          # Install the specific font you need
          fonts: Vazirmatn

      # Step 3: Install the Typst compiler
      - name: Setup Typst
        uses: typst-community/setup-typst@v4

      # Step 4: Compile the Typst file to a PDF using the standard CLI
      # The '--font-path' argument is crucial here to tell Typst where Fontist put Vazirmatn.
      - name: Compile paper.typ to PDF
        run: |
          typst compile main.typ document.pdf --font-path ~/.fontist/fonts

      # Step 5: Upload the generated PDF to the release
      - name: Upload PDF to Release
        uses: softprops/action-gh-release@v1
        with:
          # Reference the file generated in the repository root
          files: document.pdf
